!function(t){var e={};function i(s){if(e[s])return e[s].exports;var r=e[s]={i:s,l:!1,exports:{}};return t[s].call(r.exports,r,r.exports,i),r.l=!0,r.exports}i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)i.d(s,r,function(e){return t[e]}.bind(null,r));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=5)}([function(t,e){var i;i=function(){return this}();try{i=i||new Function("return this")()}catch(t){"object"==typeof window&&(i=window)}t.exports=i},function(t,e,i){(function(t,e){const i=new Object;window.cg=i,"undefined"==typeof window&&t&&(t.window={performance:{now:function(t){if(!t)return Date.now();var e=Date.now(t);return Math.round(1e3*e[0]+e[1]/1e6)}},requestAnimationFrame:function(t){e(()=>t(this.performance.now()))}})}).call(this,i(0),i(2).setImmediate)},function(t,e,i){(function(t){var s=void 0!==t&&t||"undefined"!=typeof self&&self||window,r=Function.prototype.apply;function o(t,e){this._id=t,this._clearFn=e}e.setTimeout=function(){return new o(r.call(setTimeout,s,arguments),clearTimeout)},e.setInterval=function(){return new o(r.call(setInterval,s,arguments),clearInterval)},e.clearTimeout=e.clearInterval=function(t){t&&t.close()},o.prototype.unref=o.prototype.ref=function(){},o.prototype.close=function(){this._clearFn.call(s,this._id)},e.enroll=function(t,e){clearTimeout(t._idleTimeoutId),t._idleTimeout=e},e.unenroll=function(t){clearTimeout(t._idleTimeoutId),t._idleTimeout=-1},e._unrefActive=e.active=function(t){clearTimeout(t._idleTimeoutId);var e=t._idleTimeout;e>=0&&(t._idleTimeoutId=setTimeout(function(){t._onTimeout&&t._onTimeout()},e))},i(3),e.setImmediate="undefined"!=typeof self&&self.setImmediate||void 0!==t&&t.setImmediate||this&&this.setImmediate,e.clearImmediate="undefined"!=typeof self&&self.clearImmediate||void 0!==t&&t.clearImmediate||this&&this.clearImmediate}).call(this,i(0))},function(t,e,i){(function(t,e){!function(t,i){"use strict";if(!t.setImmediate){var s,r,o,n,a,l=1,h={},c=!1,u=t.document,p=Object.getPrototypeOf&&Object.getPrototypeOf(t);p=p&&p.setTimeout?p:t,"[object process]"==={}.toString.call(t.process)?s=function(t){e.nextTick(function(){y(t)})}:!function(){if(t.postMessage&&!t.importScripts){var e=!0,i=t.onmessage;return t.onmessage=function(){e=!1},t.postMessage("","*"),t.onmessage=i,e}}()?t.MessageChannel?((o=new MessageChannel).port1.onmessage=function(t){y(t.data)},s=function(t){o.port2.postMessage(t)}):u&&"onreadystatechange"in u.createElement("script")?(r=u.documentElement,s=function(t){var e=u.createElement("script");e.onreadystatechange=function(){y(t),e.onreadystatechange=null,r.removeChild(e),e=null},r.appendChild(e)}):s=function(t){setTimeout(y,0,t)}:(n="setImmediate$"+Math.random()+"$",a=function(e){e.source===t&&"string"==typeof e.data&&0===e.data.indexOf(n)&&y(+e.data.slice(n.length))},t.addEventListener?t.addEventListener("message",a,!1):t.attachEvent("onmessage",a),s=function(e){t.postMessage(n+e,"*")}),p.setImmediate=function(t){"function"!=typeof t&&(t=new Function(""+t));for(var e=new Array(arguments.length-1),i=0;i<e.length;i++)e[i]=arguments[i+1];var r={callback:t,args:e};return h[l]=r,s(l),l++},p.clearImmediate=f}function f(t){delete h[t]}function y(t){if(c)setTimeout(y,0,t);else{var e=h[t];if(e){c=!0;try{!function(t){var e=t.callback,s=t.args;switch(s.length){case 0:e();break;case 1:e(s[0]);break;case 2:e(s[0],s[1]);break;case 3:e(s[0],s[1],s[2]);break;default:e.apply(i,s)}}(e)}finally{f(t),c=!1}}}}}("undefined"==typeof self?void 0===t?this:t:self)}).call(this,i(0),i(4))},function(t,e){var i,s,r=t.exports={};function o(){throw new Error("setTimeout has not been defined")}function n(){throw new Error("clearTimeout has not been defined")}function a(t){if(i===setTimeout)return setTimeout(t,0);if((i===o||!i)&&setTimeout)return i=setTimeout,setTimeout(t,0);try{return i(t,0)}catch(e){try{return i.call(null,t,0)}catch(e){return i.call(this,t,0)}}}!function(){try{i="function"==typeof setTimeout?setTimeout:o}catch(t){i=o}try{s="function"==typeof clearTimeout?clearTimeout:n}catch(t){s=n}}();var l,h=[],c=!1,u=-1;function p(){c&&l&&(c=!1,l.length?h=l.concat(h):u=-1,h.length&&f())}function f(){if(!c){var t=a(p);c=!0;for(var e=h.length;e;){for(l=h,h=[];++u<e;)l&&l[u].run();u=-1,e=h.length}l=null,c=!1,function(t){if(s===clearTimeout)return clearTimeout(t);if((s===n||!s)&&clearTimeout)return s=clearTimeout,clearTimeout(t);try{s(t)}catch(e){try{return s.call(null,t)}catch(e){return s.call(this,t)}}}(t)}}function y(t,e){this.fun=t,this.array=e}function d(){}r.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)e[i-1]=arguments[i];h.push(new y(t,e)),1!==h.length||c||a(f)},y.prototype.run=function(){this.fun.apply(null,this.array)},r.title="browser",r.browser=!0,r.env={},r.argv=[],r.version="",r.versions={},r.on=d,r.addListener=d,r.once=d,r.off=d,r.removeListener=d,r.removeAllListeners=d,r.emit=d,r.prependListener=d,r.prependOnceListener=d,r.listeners=function(t){return[]},r.binding=function(t){throw new Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(t){throw new Error("process.chdir is not supported")},r.umask=function(){return 0}},function(t,e,i){"use strict";i.r(e);i(1);class s{constructor(t,e,i){this.size=t.x,this.width=e,this.height=i,this.rows=Math.ceil(i/t.x),this.cols=e/t.x,this.grid={}}hash(t){return{col:Math.floor(t.x/this.size.x),row:Math.floor(t.y/this.size.x)}}add(t){let e=t.fixture.getAABB(),i=this.hash({x:e.pos.x+e.edges[0].x,y:e.pos.y+e.edges[1].y}),s=this.hash({x:e.pos.x+e.edges[2].x,y:e.pos.y+e.edges[3].y});for(let e=i.row;e<s.row+1;e++)for(let r=i.col;r<s.col+1;r++)this.grid[e]?this.grid[e][r]?this.grid[e][r].push(t):this.grid[e][r]=[t]:(this.grid[e]={},this.grid[e][r]=[t])}update(t){this.remove(t),this.add(t)}remove(t){let e=t.fixture.getAABB(),i=this.hash({x:e.pos.x+e.edges[0].x,y:e.pos.y+e.edges[1].y}),s=this.hash({x:e.pos.x+e.edges[2].x,y:e.pos.y+e.edges[3].y});for(let e=i.row;e<s.row+1;e++)for(let r=i.col;r<s.col+1;r++){let i=this.grid[e][r].indexOf(t);-1!==i&&this.grid[e][r].splice(i,1)}}query(t){let e=t.fixture.getAABB(),i=this.hash({x:e.pos.x+e.edges[0].x,y:e.pos.y+e.edges[1].y}),s=this.hash({x:e.pos.x+e.edges[2].x,y:e.pos.y+e.edges[3].y}),r=[];for(let e=i.row;e<s.row+1;e++)for(let o=i.col;o<s.col+1;o++)this.grid[e][o].forEach(e=>{-1===r.indexOf(e)&&e!==t&&r.push(e)});return r}queryPoint(t){return this.hash(t)}clear(){this.grid={}}draw(t){for(let e=0;e<this.width;e+=this.size)for(let i=0;i<this.height;i+=this.size)t.beginPath(),t.strokeStyle="green",t.rect(e,i,this.size,this.size),t.stroke()}}function r(t,e){this.x=t||0,this.y=e||0}r.prototype.copy=r.prototype.copy=function(t){return this.x=t.x,this.y=t.y,this},r.prototype.clone=r.prototype.clone=function(){return new r(this.x,this.y)},r.prototype.perp=r.prototype.perp=function(){var t=this.x;return this.x=this.y,this.y=-t,this},r.prototype.rotate=r.prototype.rotate=function(t){var e=this.x,i=this.y;return this.x=e*Math.cos(t)-i*Math.sin(t),this.y=e*Math.sin(t)+i*Math.cos(t),this},r.prototype.reverse=r.prototype.reverse=function(){return this.x=-this.x,this.y=-this.y,this},r.prototype.normalize=r.prototype.normalize=function(){var t=this.len();return t>0&&(this.x=this.x/t,this.y=this.y/t),this},r.prototype.add=r.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this},r.prototype.sub=r.prototype.sub=function(t){return this.x-=t.x,this.y-=t.y,this},r.prototype.scale=r.prototype.scale=function(t,e){return this.x*=t,this.y*=void 0!==e?e:t,this},r.prototype.project=r.prototype.project=function(t){var e=this.dot(t)/t.len2();return this.x=e*t.x,this.y=e*t.y,this},r.prototype.projectN=r.prototype.projectN=function(t){var e=this.dot(t);return this.x=e*t.x,this.y=e*t.y,this},r.prototype.reflect=r.prototype.reflect=function(t){var e=this.x,i=this.y;return this.project(t).scale(2),this.x-=e,this.y-=i,this},r.prototype.reflectN=r.prototype.reflectN=function(t){var e=this.x,i=this.y;return this.projectN(t).scale(2),this.x-=e,this.y-=i,this},r.prototype.dot=r.prototype.dot=function(t){return this.x*t.x+this.y*t.y},r.prototype.len2=r.prototype.len2=function(){return this.dot(this)},r.prototype.len=r.prototype.len=function(){return Math.sqrt(this.len2())};const o={Solid:class{constructor(t,e){this.body=t,this.style=e.style,this.fixture=t.fixture,this.position=t.state.position}render(){let t=this.body,e=t.context;switch(e.fillStyle=this.style.fillStyle,e.lineWidth=this.style.lineWidth,e.strokeStyle=this.style.strokeStyle,e.lineJoin="miter",t.fixture.type){case"circle":e.beginPath(),e.ellipse(t.state.position.x,t.state.position.y,t.fixture.r,t.fixture.r,0,0,2*Math.PI),e.closePath(),e.stroke(),e.fill();break;case"polygon":e.beginPath(),e.moveTo(t.fixture.points[0].x,t.fixture.points[0].y);for(let i=1;i<t.fixture.points.length;i++){let s=t.fixture.points[i];e.lineTo(s.x,s.y)}e.stroke()}}},Sprite:class{constructor(t,e){let i=Math.floor(e.sprite.image.width/e.sprite.width),s=Math.floor(e.sprite.image.height/e.sprite.height),r=new Array;for(let t=0;t<i;t++)for(let e=0;e<s;e++)r.push({x:t,y:e});new Array([]).fill(r.length)}update(){super.update(),this.frame=this.animation.frames.shift(),this.animation.frames.push(this.frame)}render(){let t=this.frame;cg.context.drawImage(this.image,this.grid[t].x*this.size.x,this.grid[t].y*this.size.y,this.size.x,this.size.y,this.pos.x,this.pos.y,this.size.x,this.size.y)}}};class n{constructor(t){let e=r,i=Number,s=Object,n=String,a=Array;t.debug=t.debug||!1,t.position=t.position||new e(0,0),t.angle=t.angle||new i(0),t.velocity=t.velocity||new e(0,0),t.acceleration=t.acceleration||new e(0,0),t.texture=t.texture||new s({}),t.texture.style=t.texture.style||new s({}),t.texture.style.fillStyle=t.texture.style.fillStyle||new n("#ddd"),t.texture.style.lineWidth=t.texture.style.lineWidth||new i(2),t.texture.style.strokeStyle=t.texture.style.strokeStyle||new n("#333"),this.debug=t.debug,this.state={},this.state.position=t.position,this.state.angle=t.angle,t.collision=t.collision||new s({}),t.collision.collides=t.collision.collides||!0,t.collision.group=t.collision.group||new a(["everyone"]),t.collision.checkAgenist=t.collision.checkAgenist||new a(["everyone"]),t.gravityFactor=t.gravityFactor||new e(0,0),this.collision={collides:t.collision.collides,group:t.collision.group,checkAgenist:t.collision.checkAgenist},this.gravityFactor=t.gravityFactor,this.state.velocity=t.velocity,this.state.acceleration=t.acceleration,this.types={kinematic:"kinematic",dynamic:"kinematic"},this.type=t.type,this.fixture={},this.texture=new o.Solid(this,{style:{fillStyle:t.texture.style.fillStyle,lineWidth:t.texture.style.lineWidth,strokeStyle:t.texture.style.strokeStyle},sprite:{}})}update(){}render(){let t=this.texture.style,e=this.context;e.fillStyle=t.fillStyle,e.lineWidth=t.lineWidth,e.strokeStyle=t.strokeStyle,e.lineJoin="miter"}}class a{constructor(t,e){var i={elapsed:0,tframe:1e3/e,nframe:e,before:window.performance.now(),main:function(){i.startLoop=window.requestAnimationFrame(i.main),i.delta=Math.round(1e3/(window.performance.now()-i.before)*100/100),window.performance.now()<i.before+i.tframe||(i.before=window.performance.now(),i.stopLoop=()=>{window.cancelAnimationFrame(i.startLoop)},t.state.loop=i,t.update(i.elapsed,i.delta),t.render(i.elapsed,i.delta),i.elapsed++)}};return i.main(),i}}class l{constructor(t,e,i){i=document.querySelector(i||"body");var s=document.createElement("canvas"),r=s.getContext("2d"),o=window.devicePixelRatio/["webkitBackingStorePixelRatio","mozBackingStorePixelRatio","msBackingStorePixelRatio","oBackingStorePixelRatio","backingStorePixelRatio"].reduce(function(t,e){return Object.prototype.hasOwnProperty.call(r,e)?r[e]:1});return s.width=Math.round(t*o),s.height=Math.round(e*o),s.style.width=t+"px",s.style.height=e+"px",r.setTransform(o,0,0,o,0,0),i.insertBefore(s,i.firstChild),s.context=s.getContext("2d"),s.resize=(t,e)=>{s.style.width=e.x+"px",s.style.height=e.y+"px",s.width=Math.round(e.x*o),s.height=Math.round(e.y*o),r.setTransform(o,0,0,o,0,0),t.state.size.x=e.x,t.state.size.y=e.y},s.clear=(t,e,i,r,o)=>{t=t||null,e=e||0,i=i||0,r=r||s.width,o=o||s.height,t?(s.context.save(),s.context.fillStyle=t,s.context.fillRect(e,i,r,o),s.context.fill(),s.context.restore()):s.context.clearRect(e,i,r,o)},s.camera=(t,e)=>{s.context.setTransform(1,0,0,1,0,0),s.context.translate(-t,-e)},s}}class h{constructor(t,e,i){this.resources=t,this.callback=e,this.viewport=i,this.context=i.context,this.state={tick:0}}update(){this.state.tick++,this.state.tick>90&&this.callback()}render(){this.viewport.clear("#333");let t=this.context;t.fillStyle="#fff",t.font="2em Arial",t.fillText("Loading...️",65,this.viewport.height/3,this.viewport.width),t.font="0.5em Arial",t.fillText("http://github.com/swashvirus/craters.js️",10,this.viewport.height/1.55,this.viewport.width)}}class c{constructor(t,e){this.type="polygon",this.pos=t||new r,this.angle=0,this.offset=new r,this.setPoints(e||[])}setPoints(t){if(!this.points||this.points.length!==t.length){var e,i=this.calcPoints=[],s=this.edges=[],o=this.normals=[];for(e=0;e<t.length;e++){var n=t[e],a=e<t.length-1?t[e+1]:t[0];n===a||n.x!==a.x||n.y!==a.y?(i.push(new r),s.push(new r),o.push(new r)):(t.splice(e,1),e-=1)}}return this.points=t,this._recalc(),this}setAngle(t){return this.angle=t,this._recalc(),this}setOffset(t){return this.offset=t,this._recalc(),this}rotate(t){for(var e=this.points,i=e.length,s=0;s<i;s++)e[s].rotate(t);return this._recalc(),this}translate(t,e){for(var i=this.points,s=i.length,r=0;r<s;r++)i[r].x+=t,i[r].y+=e;return this._recalc(),this}_recalc(){var t,e=this.calcPoints,i=this.edges,s=this.normals,r=this.points,o=this.offset,n=this.angle,a=r.length;for(t=0;t<a;t++){var l=e[t].copy(r[t]);l.x+=o.x,l.y+=o.y,0!==n&&l.rotate(n)}for(t=0;t<a;t++){var h=e[t],c=t<a-1?e[t+1]:e[0],u=i[t].copy(c).sub(h);s[t].copy(u).perp().normalize()}return this}getAABB(){for(var t=this.calcPoints,e=t.length,i=t[0].x,s=t[0].y,o=t[0].x,n=t[0].y,a=1;a<e;a++){var l=t[a];l.x<i?i=l.x:l.x>o&&(o=l.x),l.y<s?s=l.y:l.y>n&&(n=l.y)}return new u(this.pos.clone().add(new r(i,s)),o-i,n-s).toPolygon()}getCentroid(){for(var t=this.calcPoints,e=t.length,i=0,s=0,o=0,n=0;n<e;n++){var a=t[n],l=n===e-1?t[0]:t[n+1],h=a.x*l.y-l.x*a.y;i+=(a.x+l.x)*h,s+=(a.y+l.y)*h,o+=h}return new r(i/=o*=3,s/=o)}}class u{constructor(t,e,i){this.pos=t||new r,this.w=e||0,this.h=i||0}toPolygon(){var t=this.pos,e=this.w,i=this.h;return new c(new r(t.x,t.y),[new r,new r(e,0),new r(e,i),new r(0,i)])}}class p{constructor(t,e){this.type="circle",this.pos=t||new r,this.r=e||0,this.offset=new r}getAABB(){var t=this.r,e=this.pos.clone().add(this.offset).sub(new r(t,t));return new u(e,2*t,2*t).toPolygon()}getCentroid(){let t=this.getAABB(),e=t.edges[3].x,i=t.edges[2].y;return new r((t.edges[0].x-e)/2,(t.edges[1].y-i)/2)}setOffset(t){return this.offset=t,this}}const f={Circle:p,Polygon:c};class y{constructor(t){this.tilemaps=[],this.level=null,this.pool=[]}__load(t,e){t.tilesets.forEach(()=>{}),t.layers.forEach(()=>{}),this.tilemaps[e]=t}load(t,e){this.tilemaps[e]=t}set(t){if(!this.tilemaps[t])return;this.pool=[],this.tilemaps[t].this.level=this.tilemaps[t]}update(t){this.pool.forEach(t=>{t.update()})}render(t){this.pool.forEach(t=>{t.render()})}}class d{static collides(t,e){return!(!t.collision.collides||!e.collision.collides)}static query(t,e,i){let s=[];i.query(t);return e.forEach(t=>{i.query(t);s.push(t)}),s}}class g{static overlap(t,e){return!0}static query(t,e){let i=[];return e.forEach(e=>{this.overlap(e,t)&&i.push(e)}),i}}var x={AABB:u,Circle:p,Polygon:c};function v(){this.a=null,this.b=null,this.overlapN=new r,this.overlapV=new r,this.clear()}x.Response=v,v.prototype.clear=v.prototype.clear=function(){return this.aInB=!0,this.bInA=!0,this.overlap=Number.MAX_VALUE,this};for(var m=[],w=0;w<10;w++)m.push(new r);var b=[];for(w=0;w<5;w++)b.push([]);var A=new v,T=new u(new r,1e-6,1e-6).toPolygon();function P(t,e,i){for(var s=Number.MAX_VALUE,r=-Number.MAX_VALUE,o=t.length,n=0;n<o;n++){var a=t[n].dot(e);a<s&&(s=a),a>r&&(r=a)}i[0]=s,i[1]=r}function k(t,e,i,s,r,o){var n=b.pop(),a=b.pop(),l=m.pop().copy(e).sub(t),h=l.dot(r);if(P(i,r,n),P(s,r,a),a[0]+=h,a[1]+=h,n[0]>a[1]||a[0]>n[1])return m.push(l),b.push(n),b.push(a),!0;if(o){var c,u,p=0;if(n[0]<a[0])if(o.aInB=!1,n[1]<a[1])p=n[1]-a[0],o.bInA=!1;else p=(c=n[1]-a[0])<(u=a[1]-n[0])?c:-u;else if(o.bInA=!1,n[1]>a[1])p=n[0]-a[1],o.aInB=!1;else p=(c=n[1]-a[0])<(u=a[1]-n[0])?c:-u;var f=Math.abs(p);f<o.overlap&&(o.overlap=f,o.overlapN.copy(r),p<0&&o.overlapN.reverse())}return m.push(l),b.push(n),b.push(a),!1}function I(t,e){var i=t.len2(),s=e.dot(t);return s<0?M:s>i?z:S}x.isSeparatingAxis=k;var M=-1,S=0,z=1;function _(t,e,i){for(var s=m.pop().copy(e.pos).add(e.offset).sub(t.pos),r=e.r,o=r*r,n=t.calcPoints,a=n.length,l=m.pop(),h=m.pop(),c=0;c<a;c++){var u=c===a-1?0:c+1,p=0===c?a-1:c-1,f=0,y=null;l.copy(t.edges[c]),h.copy(s).sub(n[c]),i&&h.len2()>o&&(i.aInB=!1);var d=I(l,h);if(d===M){l.copy(t.edges[p]);var g=m.pop().copy(s).sub(n[p]);if((d=I(l,g))===z){if((v=h.len())>r)return m.push(s),m.push(l),m.push(h),m.push(g),!1;i&&(i.bInA=!1,y=h.normalize(),f=r-v)}m.push(g)}else if(d===z){if(l.copy(t.edges[u]),h.copy(s).sub(n[u]),(d=I(l,h))===M){if((v=h.len())>r)return m.push(s),m.push(l),m.push(h),!1;i&&(i.bInA=!1,y=h.normalize(),f=r-v)}}else{var x=l.perp().normalize(),v=h.dot(x),w=Math.abs(v);if(v>0&&w>r)return m.push(s),m.push(x),m.push(h),!1;i&&(y=x,f=r-v,(v>=0||f<2*r)&&(i.bInA=!1))}y&&i&&Math.abs(f)<Math.abs(i.overlap)&&(i.overlap=f,i.overlapN.copy(y))}return i&&(i.a=t,i.b=e,i.overlapV.copy(i.overlapN).scale(i.overlap)),m.push(s),m.push(l),m.push(h),!0}function B(t,e,i){for(var s=t.calcPoints,r=s.length,o=e.calcPoints,n=o.length,a=0;a<r;a++)if(k(t.pos,e.pos,s,o,t.normals[a],i))return!1;for(a=0;a<n;a++)if(k(t.pos,e.pos,s,o,e.normals[a],i))return!1;return i&&(i.a=t,i.b=e,i.overlapV.copy(i.overlapN).scale(i.overlap)),!0}x.pointInCircle=function(t,e){var i=m.pop().copy(t).sub(e.pos).sub(e.offset),s=e.r*e.r,r=i.len2();return m.push(i),r<=s},x.pointInPolygon=function(t,e){T.pos.copy(t),A.clear();var i=B(T,e,A);return i&&(i=A.aInB),i},x.testCircleCircle=function(t,e,i){var s=m.pop().copy(e.pos).add(e.offset).sub(t.pos).sub(t.offset),r=t.r+e.r,o=r*r,n=s.len2();if(n>o)return m.push(s),!1;if(i){var a=Math.sqrt(n);i.a=t,i.b=e,i.overlap=r-a,i.overlapN.copy(s.normalize()),i.overlapV.copy(s).scale(i.overlap),i.aInB=t.r<=e.r&&a<=e.r-t.r,i.bInA=e.r<=t.r&&a<=t.r-e.r}return m.push(s),!0},x.testPolygonCircle=_,x.testCirclePolygon=function(t,e,i){var s=_(e,t,i);if(s&&i){var r=i.a,o=i.aInB;i.overlapN.reverse(),i.overlapV.reverse(),i.a=i.b,i.b=r,i.aInB=i.bInA,i.bInA=o}return s},x.testPolygonPolygon=B;var j=x;class O{constructor(){this.response=new j.Response}resolve(t,e){e.forEach(e=>{let i;(i=e.fixture instanceof p?t.fixture instanceof p?j.testCircleCircle(e.fixture,t.fixture,this.response):j.testCirclePolygon(e.fixture,t.fixture,this.response):t.fixture instanceof p?j.testPolygonCircle(e.fixture,t.fixture,this.response):j.testPolygonPolygon(e.fixture,t.fixture,this.response))&&(this.response.overlapV.scale(.5),e.state.position.sub(this.response.overlapV),t.state.position.add(this.response.overlapV),e.state.velocity.sub(this.response.overlapV),t.state.velocity.add(this.response.overlapV)),this.response.clear()})}}class E{constructor(t){let e=r,i=Number,o=(Object,String,Array);t.entities=t.entities||new o,t.size=t.size||new e(1e3,500),t.gravity=t.gravity||new e(0,0),t.hash=t.hash||new e(100,100),t.resources=t.resources||new o,t.fps=t.fps||new i(60),t.debug=t.debug||!1,this.entities=t.entities,this.debug=t.debug,this.state={size:t.size,gravity:t.gravity},this.hash=new s(t.hash,t.size.x,t.size.y),this.solver=new O,this.tilemap=new y,this.viewport=new l(this.state.size.x,this.state.size.y,t.container),this.resources=new a(new h(t.resources,e=>{console.info("resources loaded"),this.assets=e,this.resources.stopLoop(),this.loop=new a(this,t.fps)},this.viewport),t.fps),this.context=this.viewport.context,window.cg=this}addObject(t){return t.context=this.context,this.hash.add(t),this.entities.push(t)}removeObject(t){return this.hash.remove(this.entities[t]),this.entities.splice(t,1)}update(){this.hash.clear(),this.tilemap.update(),this.entities.forEach(t=>{this.hash.update(t);let e=d.query(t,this.entities,this.hash),i=g.query(t,e);this.solver.resolve(t,i),t.state.acceleration.add(this.state.gravity),t.state.velocity.add(t.state.acceleration),t.state.position.add(t.state.velocity),t.update()})}render(){this.viewport.clear(),this.tilemap.render(),this.debug&&this.hash.draw(this.context),this.entities.forEach(t=>{t.render(),t.texture.render()})}}class C extends n{constructor(t){super({debug:!0,texture:{style:{fillStyle:"green",strokeStyle:"white"}},velocity:new r(2*(Math.random()-.5),2*(Math.random()-.5))}),this.scope=t,this.state.position.x=Math.random()*this.scope.state.size.x,this.state.position.y=Math.random()*this.scope.state.size.y,this.fixture=new f.Circle(this.state.position,50)}update(){if(this.state.position.x+this.fixture.r>this.scope.state.size.x){if(this.state.velocity.x<0)return;this.state.velocity.x*=-1}if(this.state.position.y+this.fixture.r>this.scope.state.size.y){if(this.state.velocity.y<0)return;this.state.velocity.y*=-1}if(this.state.position.x-this.fixture.r<0){if(this.state.velocity.x>0)return;this.state.velocity.x*=-1}if(this.state.position.y-this.fixture.r<0){if(this.state.velocity.y>0)return;this.state.velocity.y*=-1}}render(){super.render()}}new class extends E{constructor(t,e,i){super({debug:!0,fps:60,container:"#container",size:new r(500,500),hash:new r(50,50)}),this.viewport.style.background="#eee",this.viewport.resize(this,{x:window.innerWidth,y:window.innerHeight});for(var s=0;s<10;s++){let t=this.addObject(new C(this))-1;this.entities[t].id=t}}render(){super.render()}}("#container",1024,512)}]);